---
description: git diffの未コミット変更をAgent Teamで並列レビュー
---

# 役割
未コミット変更に対する3観点並列コードレビューの実行

# ワークフロー

## 1. 差分取得
- `git diff` でステージ前の変更を取得
- `git diff --cached` でステージ済みの変更を取得
- 変更がなければ「レビュー対象なし」と出力して終了

## 2. CLAUDE.md取得
- プロジェクトルートの `.claude/CLAUDE.md` を読む
- `.claude/rules/` 配下のルールファイルも全て読む
- グローバルの `~/.claude/CLAUDE.md` も読む

## 3. チーム作成・並列レビュー
- TeamCreateでレビューチームを作成
- 以下3エージェントをTaskツールで**並列起動**（各エージェントは `subagent_type: "general-purpose"` を使用）
- 各エージェントには差分とCLAUDE.mdの内容をプロンプトに含めて渡す

### エージェント構成
1. **bug-detector** - バグ検出
   - 明らかなバグ・ロジックミス
   - 型の不整合
   - null/undefined参照の可能性
   - off-by-oneエラー

2. **convention-checker** - CLAUDE.md準拠チェック
   - プロジェクト規約への適合性
   - コーディング規約違反
   - ディレクトリ構造・命名規則の逸脱

3. **security-quality** - セキュリティ・品質
   - セキュリティ脆弱性（OWASP Top 10）
   - エラーハンドリングの不備
   - リソースリークの可能性

### 各エージェントへの指示
- 差分のみをレビュー対象とする（差分外のコードは参考程度）
- 必要に応じてGlob/Grep/Readで周辺コードを確認
- 結果は以下の形式で返すこと:
  ```
  ## Critical（修正必須）
  - 説明 [file:line]

  ## Warning（推奨修正）
  - 説明 [file:line]

  ## Info（参考）
  - 説明 [file:line]
  ```
- 指摘がないカテゴリは省略可
- 指摘がゼロの場合は「指摘なし」と返す

## 4. 結果集約・出力
- 3エージェントの結果を待機
- チームを削除
- 以下の形式でターミナルに出力:

```markdown
# レビュー結果

## Critical（修正必須）
- [バグ検出]: 説明 [file:line]
- [セキュリティ]: 説明 [file:line]

## Warning（推奨修正）
- [規約違反]: 説明 [file:line]

## Info（参考）
- [品質]: 説明 [file:line]
```

# ルール
- 全エージェントの完了を待ってから結果を出力
- 指摘がないカテゴリ（Critical/Warning/Info）は省略
- 全観点で指摘なしの場合は「問題なし」と出力
- レビュー結果の出力は日本語で
- 各指摘には必ずファイルパスと行番号を含める
